services:
  dremio-mcp:
    build: 
      context: ./services/dremio-mcp
      dockerfile: Dockerfile
    ports:
      - "7910:7910"
    environment:
      - DREMIO_URI=${DREMIO_URI}
      - EXTRA_ARGS=${MCP_EXTRA_ARGS:-}
    # the token is set by the token refresher service
    # but you can also mount your token here and remove the token refresher service
    volumes:
      - token-volume:/app/tokens:ro
    depends_on:
      - token-refresher
    # make sure $DREMIO_URI is accessible to the dremio mcp service on a network ...
    networks:
      - dremio-mcp-network
    # ... or as an extra_host:
    extra_hosts:
      - "dremio.dev.serraict.me:host-gateway"

  token-refresher:
    build:
      context: ./services/token-refresher
      dockerfile: Dockerfile
    container_name: "${COMPOSE_PROJECT_NAME:-dremio-mcp-docker}_token-refresher_1"
    environment:
      - DREMIO_URI=${DREMIO_URI}
      - DREMIO_USERNAME=${DREMIO_USERNAME}
      - DREMIO_PASSWORD=${DREMIO_PASSWORD}
      - REFRESH_INTERVAL=${REFRESH_INTERVAL:-72000}
      - COMPOSE_PROJECT_NAME=${COMPOSE_PROJECT_NAME:-dremio-mcp-docker}
    volumes:
      - token-volume:/app/tokens:rw
    networks:
      - dremio-mcp-network
    extra_hosts:
      - "dremio.dev.serraict.me:host-gateway"

volumes:
  token-volume:
    driver: local

networks:
  dremio-mcp-network:
    driver: bridge
